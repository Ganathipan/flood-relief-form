<!DOCTYPE html>
<html>
<head>
  <title>Donor Registration - Flood Relief</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f4f7; }
    h2 { text-align: center; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select, textarea {
      width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      padding: 10px 12px; margin-top: 10px;
      background: #007bff; color: white; border: none; border-radius: 5px;
      font-size: 14px; cursor: pointer;
    }
    button:hover { background: #0056b3; }

    /* Table-style donations */
    table {
      width: 100%; border-collapse: collapse; margin-top: 8px;
      background: #ffffff;
    }
    th, td {
      border: 1px solid #ccc; padding: 6px;
    }
    th { background: #e6edf5; text-align: left; }
    .full-width-submit {
      width: 100%; margin-top: 20px; font-size: 16px;
    }
  </style>
</head>

<body>
  <h2>Donor Registration Form</h2>

  <!-- Basic info -->
  <label>Name</label>
  <input type="text" id="name" required>

  <label>Phone Number</label>
  <input type="text" id="phone" required>

  <label>District</label>
  <select id="district">
    <option value="">Select District</option>
    <option>Ampara</option>
    <option>Anuradhapura</option>
    <option>Badulla</option>
    <option>Batticaloa</option>
    <option>Colombo</option>
    <option>Galle</option>
    <option>Gampaha</option>
    <option>Hambantota</option>
    <option>Jaffna</option>
    <option>Kalutara</option>
    <option>Kandy</option>
    <option>Kegalle</option>
    <option>Kilinochchi</option>
    <option>Kurunegala</option>
    <option>Mannar</option>
    <option>Matale</option>
    <option>Matara</option>
    <option>Monaragala</option>
    <option>Mullaitivu</option>
    <option>Nuwara Eliya</option>
    <option>Polonnaruwa</option>
    <option>Puttalam</option>
    <option>Ratnapura</option>
    <option>Trincomalee</option>
    <option>Vavuniya</option>
  </select>

  <!-- GPS location -->
  <label>Your GPS Location</label>
  <input type="text" id="gps" readonly placeholder="Click 'Get My Location'">
  <button type="button" onclick="getLocation()">Get My Location</button>

  <!-- Donation table -->
  <label>Donations (item + quantity)</label>
  <table id="donationTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Quantity</th>
      </tr>
    </thead>
    <tbody>
      <!-- first row -->
      <tr>
        <td>
          <select class="donation-item">
            <option value="">Select item</option>
            <option>Food Packs</option>
            <option>Water Bottles</option>
            <option>Clothes</option>
            <option>Medicines</option>
            <option>Sanitary Items</option>
            <option>Bedding</option>
          </select>
        </td>
        <td>
          <input type="number" class="donation-qty" min="1" placeholder="Qty">
        </td>
      </tr>
    </tbody>
  </table>
  <button type="button" onclick="addDonationRow()">+ Add another item</button>

  <label>Additional Notes (Optional)</label>
  <textarea id="notes"></textarea>

  <button class="full-width-submit" onclick="submitForm()">Submit</button>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxNrPQojUsPiq6P2jWC1Ea2EtWsyPN-ImOnovUmCZnbpxNgB3m4JH_OE-xQNvOBR1cjoA/exec";
  
    function addDonationRow() {
      const tbody = document.querySelector("#donationTable tbody");
      const row = document.createElement("tr");
  
      row.innerHTML = `
        <td>
          <select class="donation-item">
            <option value="">Select item</option>
            <option>Food Packs</option>
            <option>Water Bottles</option>
            <option>Clothes</option>
            <option>Medicines</option>
            <option>Sanitary Items</option>
            <option>Bedding</option>
          </select>
        </td>
        <td>
          <input type="number" class="donation-qty" min="1" placeholder="Qty">
        </td>
      `;
      tbody.appendChild(row);
    }
  
    function getLocation() {
      if (!navigator.geolocation) {
        alert("Geolocation is not supported on this device.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude.toFixed(6);
          const lng = pos.coords.longitude.toFixed(6);
          document.getElementById("gps").value = lat + ", " + lng;
        },
        (err) => {
          alert("Unable to get location: " + err.message);
        }
      );
    }
  
    function submitForm() {
      // collect donation rows
      const rows = document.querySelectorAll("#donationTable tbody tr");
      const donationsArray = [];
  
      rows.forEach(row => {
        const item = row.querySelector(".donation-item").value;
        const qty  = row.querySelector(".donation-qty").value;
  
        if (item && qty) {
          // remove spaces in item name: "Food Packs" -> "FoodPacks"
          const itemNoSpace = item.replace(/\s+/g, "");
          // push in format ItemWithoutSpace_qty;
          donationsArray.push(itemNoSpace + "_" + qty + ";");
        }
      });
  
      if (donationsArray.length === 0) {
        alert("Please add at least one donation item and quantity.");
        return;
      }
  
      // join into one string: FoodPacks_10;WaterBottles_5;
      const donationsString = donationsArray.join("");
  
      const data = {
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        district: document.getElementById("district").value,
        donations: donationsString,                 // ðŸ‘ˆ "ItemNoSpace_qty;ItemNoSpace_qty;"
        gps: document.getElementById("gps").value,
        notes: document.getElementById("notes").value
      };
  
      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data)
      })
      .then(res => res.text())
      .then(text => {
        alert("Server says: " + text);
      })
      .catch(err => {
        alert("Error: " + err);
      });
    }
  </script>
</body>
</html>
